# API v1 ‚Üí v2 „ÇØ„É©„Ç§„Ç¢„É≥„ÉàÁßªË°å„Ç¨„Ç§„Éâ

**ÂØæË±°**: „Åô„Åπ„Å¶„ÅÆ RustCMS API „ÇØ„É©„Ç§„Ç¢„É≥„Éà (JavaScript, Python, Go, Rust „Å™„Å©)
**ÈùûÊé®Â•®ÈñãÂßã**: 2025-01-17
**ÂâäÈô§‰∫àÂÆöÊó•**: 2025-03-17
**ÁßªË°åÊúüÈñì**: 2„É∂Êúà

---

## üöÄ Ê¶ÇË¶Å

### „Å™„ÅúÁßªË°å„ÅåÂøÖË¶Å„Åã

- **API v1 „ÅØ 2025-03-17 „Å´ÂâäÈô§„Åï„Çå„Åæ„Åô**
- **v2 „Å´„ÅØÊñ∞Ê©üËÉΩ„Å®ÊîπÂñÑ„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô**
- **„Éá„Éº„Çø„Éô„Éº„Çπ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ 25-66% Âêë‰∏ä**
- **„Çà„Çä„É¢„ÉÄ„É≥„Å™ REST API Ë®≠Ë®à**

### ÁßªË°å„ÅÆÈõ£ÊòìÂ∫¶

- **JavaScript/TypeScript**: ‚≠ê Á∞°Âçò (URL ÁΩÆÊèõ„ÅÆ„Åø)
- **Python**: ‚≠ê Á∞°Âçò (URL ÁΩÆÊèõ„ÅÆ„Åø)
- **Go**: ‚≠ê Á∞°Âçò (URL ÁΩÆÊèõ„ÅÆ„Åø)
- **Rust**: ‚≠ê Á∞°Âçò (URL ÁΩÆÊèõ„ÅÆ„Åø)

---

## üìã Phase Âà•ÁßªË°åË®àÁîª

### Phase 1: Ê∫ñÂÇô (1 ÈÄ±Èñì)

**„Çø„Çπ„ÇØ**:

- [ ] ÁèæÂú®„ÅÆ v1 API ‰ΩøÁî®Áä∂Ê≥Å„ÇíÁ¢∫Ë™ç
- [ ] Â§âÊõ¥ÁÇπ„ÇíÁêÜËß£
- [ ] „ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà„ÇíÊ∫ñÂÇô

**Á¢∫Ë™ç„Ç≥„Éû„É≥„Éâ**:

```bash
# 1. „É≠„Ç∞„Åã„Çâ v1 API Âëº„Å≥Âá∫„Åó„ÇíÊ§úÂá∫
grep -r "/api/v1/" src/

# 2. v1 „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà‰ΩøÁî®Êï∞„Çí„Ç´„Ç¶„É≥„Éà
grep -r "/api/v1/" src/ | wc -l
```

### Phase 2: ÂÆüË£Ö (1 ÈÄ±Èñì)

**„Çø„Çπ„ÇØ**:

- [ ] URL „Çí„Åô„Åπ„Å¶ v2 „Å´Êõ¥Êñ∞
- [ ] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Çí‰øÆÊ≠£
- [ ] „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„É≠„Ç∏„ÉÉ„ÇØ„Çí‰øÆÊ≠£

### Phase 3: „ÉÜ„Çπ„Éà (1 ÈÄ±Èñì)

**„Çø„Çπ„ÇØ**:

- [ ] „É¶„Éã„ÉÉ„Éà„ÉÜ„Çπ„ÉàÂÆüË°å
- [ ] „Ç§„É≥„ÉÜ„Ç∞„É¨„Éº„Ç∑„Éß„É≥„ÉÜ„Çπ„ÉàÂÆüË°å
- [ ] „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß„ÉÜ„Çπ„Éà

### Phase 4: „Éá„Éó„É≠„Ç§ (1 ÈÄ±Èñì)

**„Çø„Çπ„ÇØ**:

- [ ] ÈñãÁô∫Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§
- [ ] „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§
- [ ] Êú¨Áï™Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§

---

## üîÑ ‰∏ªË¶Å„Å™Â§âÊõ¥ÁÇπ

### 1. „Éô„Éº„Çπ URL „ÅÆÂ§âÊõ¥

| Â§âÊõ¥Ââç (v1) | Â§âÊõ¥Âæå (v2) |
|-----------|----------|
| `/api/v1` | `/api/v2` |

**ÊúÄ„ÇÇÁ∞°Âçò„Å™ÂØæÂøú**: „Ç∞„É≠„Éº„Éê„É´ÁΩÆÊèõ„ÅßÂÆå‰∫Ü

```javascript
// Before
const API_BASE = 'https://api.example.com/api/v1';

// After
const API_BASE = 'https://api.example.com/api/v2';
```

### 2. „Ç®„É©„Éº„É¨„Çπ„Éù„É≥„ÇπÂΩ¢Âºè„ÅÆÂ§âÊõ¥

**v1 „Ç®„É©„Éº„É¨„Çπ„Éù„É≥„Çπ**:

```json
HTTP/1.1 400 Bad Request
{
  "error": "Invalid email format"
}
```

**v2 „Ç®„É©„Éº„É¨„Çπ„Éù„É≥„Çπ**:

```json
HTTP/1.1 400 Bad Request
{
  "errors": [
    {
      "field": "email",
      "message": "Invalid email format",
      "code": "INVALID_FORMAT"
    }
  ],
  "request_id": "req-12345"
}
```

**Êõ¥Êñ∞„Ç≥„Éº„Éâ‰æã**:

```javascript
// Before (v1)
try {
  const response = await fetch(`${API_BASE}/users`, { method: 'POST', body });
  if (!response.ok) {
    const data = await response.json();
    console.error('Error:', data.error); // ‚úÖ v1: string
  }
} catch (e) {
  console.error(e);
}

// After (v2)
try {
  const response = await fetch(`${API_BASE}/users`, { method: 'POST', body });
  if (!response.ok) {
    const data = await response.json();
    console.error('Errors:', data.errors); // ‚úÖ v2: array
    data.errors.forEach(err => {
      console.log(`${err.field}: ${err.message} (${err.code})`);
    });
  }
} catch (e) {
  console.error(e);
}
```

### 3. „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„ÅÆÂ§âÊõ¥

**v1 „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥** („Éö„Éº„Ç∏„Éô„Éº„Çπ):

```bash
GET /api/v1/posts?page=2&limit=10
# 2„Éö„Éº„Ç∏ÁõÆ„ÄÅ1„Éö„Éº„Ç∏ 10 ‰ª∂
```

**v2 „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥** („Ç™„Éï„Çª„ÉÉ„Éà„Éô„Éº„Çπ):

```bash
GET /api/v2/posts?offset=10&limit=10
# 10 ‰ª∂„Çπ„Ç≠„ÉÉ„ÉóÂæå„ÄÅ10 ‰ª∂ÂèñÂæó
```

**Â§âÊèõ„É≠„Ç∏„ÉÉ„ÇØ**:

```python
# Before (v1)
def get_page_offset_v1(page: int, limit: int) -> int:
    return (page - 1) * limit

# After (v2)
def get_page_offset_v2(page: int, limit: int) -> int:
    return (page - 1) * limit  # Same calculation!
    # Just change the parameter name in the URL

# Example migration
# v1: page=2&limit=10 ‚Üí offset=(2-1)*10=10
# v2: offset=10&limit=10 ‚Üí Same result
```

---

## üíª Ë®ÄË™ûÂà•ÁßªË°å„Ç¨„Ç§„Éâ

### JavaScript / TypeScript

#### 1. axios „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà

```javascript
// client.js

// Before (v1)
const client = axios.create({
  baseURL: 'https://api.example.com/api/v1',
});

// After (v2)
const client = axios.create({
  baseURL: 'https://api.example.com/api/v2',
});

// „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Êõ¥Êñ∞
client.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 400) {
      // v1: error.response.data.error
      // v2: error.response.data.errors[0]
      const errors = error.response.data.errors || [];
      throw new Error(errors.map(e => e.message).join(', '));
    }
    throw error;
  }
);
```

#### 2. fetch „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà

```javascript
// api.js

class APIClient {
  constructor() {
    this.baseUrl = 'https://api.example.com/api/v2'; // Changed from v1
  }

  async request(endpoint, options = {}) {
    const response = await fetch(`${this.baseUrl}${endpoint}`, options);

    if (!response.ok) {
      const data = await response.json();

      // v1: throw new Error(data.error)
      // v2: throw new Error with multiple errors
      const errors = data.errors || [];
      const message = errors.map(e => `${e.field}: ${e.message}`).join('; ');
      throw new Error(message || 'Unknown error');
    }

    return response.json();
  }

  async getPosts(offset = 0, limit = 10) {
    // Changed from: ?page=1&limit=10
    // Changed to:   ?offset=0&limit=10
    return this.request(`/posts?offset=${offset}&limit=${limit}`);
  }
}

export default new APIClient();
```

### Python

#### 1. requests „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà

```python
import requests

# client.py

class APIClient:
    def __init__(self):
        # Before: self.base_url = 'https://api.example.com/api/v1'
        # After:
        self.base_url = 'https://api.example.com/api/v2'
        self.session = requests.Session()

    def request(self, method, endpoint, **kwargs):
        url = f"{self.base_url}{endpoint}"
        response = self.session.request(method, url, **kwargs)

        if not response.ok:
            data = response.json()

            # v1: errors = [data['error']]
            # v2: errors = [f"{e['field']}: {e['message']}" for e in data['errors']]
            errors = data.get('errors', [])
            message = '; '.join([f"{e['field']}: {e['message']}" for e in errors])
            raise Exception(message or 'Unknown error')

        return response.json()

    def get_posts(self, offset=0, limit=10):
        # Changed from: ?page=1&limit=10
        # Changed to:   ?offset=0&limit=10
        return self.request('GET', f'/posts?offset={offset}&limit={limit}')

# Usage
client = APIClient()
posts = client.get_posts()
```

### Go

#### 1. net/http „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà

```go
package api

import (
    "encoding/json"
    "fmt"
    "net/http"
)

// Before: const apiBase = "https://api.example.com/api/v1"
// After:
const apiBase = "https://api.example.com/api/v2"

type ErrorResponse struct {
    Errors []ErrorDetail `json:"errors"`
}

type ErrorDetail struct {
    Field   string `json:"field"`
    Message string `json:"message"`
    Code    string `json:"code"`
}

func GetPosts(offset, limit int) ([]Post, error) {
    // Changed from: /posts?page=1&limit=10
    // Changed to:   /posts?offset=0&limit=10
    url := fmt.Sprintf("%s/posts?offset=%d&limit=%d", apiBase, offset, limit)

    resp, err := http.Get(url)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()

    if resp.StatusCode >= 400 {
        var errResp ErrorResponse
        json.NewDecoder(resp.Body).Decode(&errResp)

        var message string
        for _, err := range errResp.Errors {
            message += fmt.Sprintf("%s: %s; ", err.Field, err.Message)
        }
        return nil, fmt.Errorf(message)
    }

    var posts []Post
    json.NewDecoder(resp.Body).Decode(&posts)
    return posts, nil
}
```

### Rust

#### 1. reqwest „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà

```rust
use reqwest::Client;

const API_BASE: &str = "https://api.example.com/api/v2"; // Changed from v1

pub struct ApiClient {
    client: Client,
}

impl ApiClient {
    pub fn new() -> Self {
        Self {
            client: Client::new(),
        }
    }

    pub async fn get_posts(&self, offset: u32, limit: u32) -> Result<Vec<Post>, String> {
        // Changed from: /posts?page=1&limit=10
        // Changed to:   /posts?offset=0&limit=10
        let url = format!("{}‚Äã/posts?offset={}&limit={}", API_BASE, offset, limit);

        let response = self.client.get(&url).send().await
            .map_err(|e| e.to_string())?;

        if !response.status().is_success() {
            let error_data: serde_json::Value = response.json().await
                .map_err(|e| e.to_string())?;

            // v1: error_data["error"].as_str()
            // v2: error_data["errors"][0]["message"]
            let errors = error_data["errors"].as_array().unwrap_or(&vec![]);
            let message = errors.iter()
                .map(|e| {
                    format!("{}: {}",
                        e["field"].as_str().unwrap_or("unknown"),
                        e["message"].as_str().unwrap_or("unknown")
                    )
                })
                .collect::<Vec<_>>()
                .join("; ");

            return Err(message);
        }

        response.json().await.map_err(|e| e.to_string())
    }
}
```

---

## üß™ „ÉÜ„Çπ„Éà‰æã

### „ÉÜ„Çπ„Éà„Ç±„Éº„Çπ: POST /api/v2/users

#### ÊàêÂäü„É¨„Çπ„Éù„É≥„Çπ

```bash
curl -X POST https://api.example.com/api/v2/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "email": "john@example.com",
    "password": "SecurePass123!"
  }'

# Response (201 Created):
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "username": "john_doe",
  "email": "john@example.com",
  "created_at": "2025-01-17T10:30:00Z"
}
```

#### „Ç®„É©„Éº„É¨„Çπ„Éù„É≥„Çπ (v2 Êñ∞ÂΩ¢Âºè)

```bash
curl -X POST https://api.example.com/api/v2/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "email": "invalid_email",  # Invalid format
    "password": "short"  # Too short
  }'

# Response (400 Bad Request):
{
  "errors": [
    {
      "field": "email",
      "message": "Invalid email format",
      "code": "INVALID_EMAIL_FORMAT"
    },
    {
      "field": "password",
      "message": "Password must be at least 8 characters",
      "code": "PASSWORD_TOO_SHORT"
    }
  ],
  "request_id": "req-12345abcde"
}
```

---

## üìä ÁßªË°å„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà

### ‰∫ãÂâçÁ¢∫Ë™ç

- [ ] ÁèæÂú®„ÅÆ v1 API „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà‰∏ÄË¶ß„Çí‰ΩúÊàê
- [ ] ‰ΩøÁî®‰∏≠„ÅÆ„ÇØ„É©„Ç§„Ç¢„É≥„Éà„É©„Ç§„Éñ„É©„É™„ÇíÁ¢∫Ë™ç
- [ ] „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñÂæó
- [ ] „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß „ÉÜ„Çπ„Éà

### ÂÆüË£Ö

- [ ] „Éô„Éº„Çπ URL „Çí `/api/v1` „Åã„Çâ `/api/v2` „Å´Â§âÊõ¥
- [ ] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ „ÇíÊõ¥Êñ∞ (`error` ‚Üí `errors` ÈÖçÂàó)
- [ ] „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ „ÇíÊõ¥Êñ∞ (`page` ‚Üí `offset` „Éô„Éº„Çπ)
- [ ] „Åô„Åπ„Å¶„ÅÆ„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„Çí„ÉÜ„Çπ„Éà

### „ÉÜ„Çπ„Éà

- [ ] „É¶„Éã„ÉÉ„Éà„ÉÜ„Çπ„ÉàÂÆüË°å
- [ ] „Ç§„É≥„ÉÜ„Ç∞„É¨„Éº„Ç∑„Éß„É≥„ÉÜ„Çπ„ÉàÂÆüË°å
- [ ] „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß E2E „ÉÜ„Çπ„ÉàÂÆüË°å
- [ ] „É≠„Éº„Ç´„É´„ÅßÂÖ®„ÉÜ„Çπ„ÉàÂÆüË°å

### „Éá„Éó„É≠„Ç§

- [ ] ÈñãÁô∫Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§
- [ ] „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß„ÉÜ„Çπ„Éà
- [ ] Êú¨Áï™Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§ (ÊÆµÈöéÁöÑ„Å´)
- [ ] „É≠„Ç∞„ÇíÁõ£Ë¶ñ

### Ê§úË®º

- [ ] Êú¨Áï™Áí∞Â¢É„Åß 24 ÊôÇÈñìÁõ£Ë¶ñ
- [ ] „Ç®„É©„Éº„É≠„Ç∞Á¢∫Ë™ç
- [ ] „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊåáÊ®ôÁ¢∫Ë™ç
- [ ] v1 API „Ç¢„ÇØ„Çª„Çπ„ÇíÁõ£Ë¶ñ

---

## üÜò ÂïèÈ°å„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà

### „Ç®„É©„Éº: 404 Not Found

**ÂéüÂõ†**: „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„Åå v2 „Å´ÁßªÂãï„Åó„ÅüÂèØËÉΩÊÄß

**Ëß£Ê±∫Á≠ñ**:

```
# v1: /api/v1/users/:id
# v2: /api/v2/users/:id (Âêå„Åò)

# Á¢∫Ë™ç: /api/v1 „Çí /api/v2 „Å´ÁΩÆÊèõ„Åó„Åü„ÅãÁ¢∫Ë™ç
grep -r "/api/v1/" .
```

### „Ç®„É©„Éº: 400 Bad Request („Ç®„É©„ÉºÂΩ¢Âºè„ÅåÁï∞„Å™„Çã)

**ÂéüÂõ†**: v2 „Ç®„É©„ÉºÂΩ¢Âºè„ÅåÁï∞„Å™„Çã

**Ëß£Ê±∫Á≠ñ**:

```javascript
// Before (v1)
const error = response.data.error;

// After (v2)
const errors = response.data.errors;
const message = errors.map(e => e.message).join(', ');
```

### „Ç®„É©„Éº: „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ „ÅåÊ©üËÉΩ„Åó„Å™„ÅÑ

**ÂéüÂõ†**: `page` „Éë„É©„É°„Éº„Çø„Åå v2 „ÅßÂªÉÊ≠¢„Åï„Çå„Åü

**Ëß£Ê±∫Á≠ñ**:

```
# Before (v1)
/api/v1/posts?page=2&limit=10

# After (v2)
/api/v2/posts?offset=10&limit=10

# Ë®àÁÆó: offset = (page - 1) * limit
#       offset = (2 - 1) * 10 = 10
```

---

## üìû „Çµ„Éù„Éº„Éà

ÂïèÈ°å„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà„ÅØ„ÄÅ‰ª•‰∏ã„Å´ÈÄ£Áµ°„Åó„Å¶„Åè„Å†„Åï„ÅÑ:

- **„É°„Éº„É´**: <support@example.com>
- **Slack**: #api-support
- **GitHub Issues**: <https://github.com/example/cms/issues>
- **„Éâ„Ç≠„É•„É°„É≥„Éà**: <https://docs.example.com/migration>

---

**‰ΩúÊàêÊó•**: 2025-01-17
**ÊúÄÁµÇÊõ¥Êñ∞**: 2025-01-17
**„Çπ„ÉÜ„Éº„Çø„Çπ**: ÂÖ¨ÈñãÊ∫ñÂÇô‰∏≠
